"use strict";var _createClass=function(){function a(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}();function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var miniVU=function(){function a(b){var c=this,d=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null,e=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};return _classCallCheck(this,a),this.VERSION="beta 2.0",this.TITLE_PLACEHOLDER="{{miniVU title}}",this.DEFAULT_NOT_FOUND="<h1>404 not found</h1>",this.ERROR_MSGS={GENERIC_ERROR:"Something went wrong. For more help and documentation, see https://github.com/shawnmcla/miniVU and/or see error stack trace.",INVALID_SELECTOR:"The targetElementSelector parameter must be a non-empty string selector for which there is a corresponding element. (e.g. #idSelector, .classSelector)",ELEMENT_NOT_FOUND:"The targetElementSelector passed cannot be found in the DOM.",VIEW_NOT_FOUND:"The associated HTML document for the view specified could not be found. Check that the file exists and is in the correct directory.",NO_DEFAULT_VIEW:"No default view was specified. Specifying a default view is strongly recommended. To specify a default view, pass the view name as the second argument when instantiating miniVU."},this.CONFIG={viewsDirectory:"./views",changeTitle:!1,titlePattern:"{{miniVU title}}",customNotFound:null,customTitles:null},0!==Object.keys(e).length&&this.loadConfig(e),this.currentView=null,this.defaultView=d,this.targetArea=this.getElementFromSelector(b),this.targetArea?void(window.addEventListener("hashchange",function(a){return c.hashChangeHandler(a)}),window.addEventListener("popstate",function(a){return c.popStateHandler(a)}),console.log("Initialized miniVU version: "+this.VERSION),this.loadView(this.getViewFromHash())):null}return _createClass(a,[{key:"getViewFromHash",value:function getViewFromHash(){var a=location.hash,b="";return a&&"#/"===a.substr(0,2)&&(b=a.substr(2)),""===b?this.defaultView:b}},{key:"loadConfig",value:function loadConfig(a){var b=this;Object.keys(a).forEach(function(c){b.CONFIG.hasOwnProperty(c)?(b.CONFIG[c]=a[c],console.info("Set config "+c+" to "+a[c])):console.error("Invalid config key: "+c+". Ignoring.")})}},{key:"hashChangeHandler",value:function hashChangeHandler(a){a.preventDefault(),this.loadView(this.getViewFromHash())}},{key:"popStateHandler",value:function popStateHandler(a){a.state&&a.state.viewName&&this.loadView(a.state.viewName)}},{key:"getElementFromSelector",value:function getElementFromSelector(a){var b=null;return null!==a&&"string"==typeof a?"."===a[0]?b=document.getElementsByClassName(a.substr(1))[0]:"#"===a[0]&&(b=document.getElementById(a.substr(1))):this.errorInvalidSelector(),b||this.errorTargetNotFound(),b}},{key:"pushState",value:function pushState(a){history.replaceState({viewName:a},null,a===this.defaultView?"":"#/"+a)}},{key:"clearContent",value:function clearContent(a){for(;a.firstChild;)a.removeChild(a.firstChild)}},{key:"appendContent",value:function appendContent(a,b){console.log("appending contnet.."),"string"==typeof a?(console.log("Raw"),b.innerHTML=a):(a=a.body.childNodes,a.forEach?(console.log("NodeList foreach implemented.."),a.forEach(function(a){return b.appendChild(a)})):(console.log("Array prototype .call() fallback"),Array.prototype.forEach.call(a,function(a){return b.appendChild(a)})))}},{key:"loadHTMLContent",value:function loadHTMLContent(a){var b=this,c=1<arguments.length&&void 0!==arguments[1]&&arguments[1];return new Promise(function(d,e){var f=new XMLHttpRequest;f.onload=function(){4===f.readyState&&(200===f.status?d(f.response):e(f.statusText))},f.onerror=function(){e(f.statusText)};var g=b.CONFIG.viewsDirectory;f.open("GET",g+("/"===g.substr(-1)?a:"/"+a)),c||(f.responseType="document"),f.send()})}},{key:"replaceContent",value:function replaceContent(a,b){if(this.clearContent(this.targetArea),this.appendContent(b,this.targetArea),this.currentView=a,this.CONFIG.changeTitle){var c=a;this.CONFIG.customTitles&&this.CONFIG.customTitles[a]&&(c=this.CONFIG.customTitles[a]),document.title=this.CONFIG.titlePattern.replace(this.TITLE_PLACEHOLDER,c)}this.pushState(a)}},{key:"loadView",value:function loadView(a){var b=this;null===a&&console.error("Tried to load 'null' view. Did you specify a default view?"),a!==this.currentView&&this.loadHTMLContent(a+".html").then(function(c){return b.replaceContent(a,c)}).catch(function(c){return b.errorViewNotfound(a,c)})}},{key:"errorGeneric",value:function errorGeneric(a){console.error(this.GENERIC_ERROR,a)}},{key:"errorInvalidSelector",value:function errorInvalidSelector(){console.error(this.ERROR_MSGS.INVALID_SELECTOR)}},{key:"errorTargetNotFound",value:function errorTargetNotFound(){console.error(this.ERROR_MSGS.ELEMENT_NOT_FOUND)}},{key:"errorViewNotfound",value:function errorViewNotfound(a,b){console.error(this.ERROR_MSGS.VIEW_NOT_FOUND+" View name: "+a+", Views directory: "+this.CONFIG.viewsDirectory,b),this.CONFIG.customNotFound&&a!==this.CONFIG.customNotFound?this.loadView(this.CONFIG.customNotFound):this.replaceContent("404",this.DEFAULT_NOT_FOUND,!0)}}]),a}();
